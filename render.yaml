services:
  # Backend API Service
  - type: web
    name: kudimall-api
    env: node
    region: oregon
    plan: free
    buildCommand: cd server && npm install
    # ⚠️ CRITICAL: Do NOT change this `startCommand`!
    # ⚠️ Do NOT add psql commands or database migrations to `startCommand`
    # The application auto-initializes the database on first startup via server/index.js
    # Database tables are created automatically using server/scripts/initDb.js
    # If you see "No such file or directory" errors, see RENDER_FIX_INSTRUCTIONS.md
    startCommand: cd server && node index.js
    envVars:
      - key: NODE_ENV
        value: production
      - key: PORT
        value: 5000
      - key: DATABASE_URL
        fromDatabase:
          name: kudimall-db
          property: connectionString
      - key: JWT_SECRET
        generateValue: true
      - key: FRONTEND_URL
        value: https://kudimall.onrender.com
      # Email Configuration - Configure these for seller verification emails
      # Get Gmail App Password: https://myaccount.google.com/apppasswords
      # To enable email verification, set EMAIL_USER and EMAIL_PASSWORD in Render dashboard
      - key: EMAIL_USER
        sync: false  # Set this in Render dashboard
      - key: EMAIL_PASSWORD
        sync: false  # Set this in Render dashboard
      # Auto-verify accounts when email is not configured (allows app to work without email)
      # Set to 'false' and configure EMAIL_USER/EMAIL_PASSWORD for full email verification
      - key: SKIP_EMAIL_VERIFICATION
        value: 'true'
    healthCheckPath: /api/health
    
  # PostgreSQL Database
databases:
  - name: kudimall-db
    databaseName: kudimall_prod
    user: kudimall_user
    region: oregon
    plan: free
    ipAllowList: []
